library(tidyverse)
library(sf)

load(file = "output/super_ecoregions.rda")

# add "not defined for regions without samples
load(file = "output/super_region_without_sample.rda")
super_regions <- super_regions %>%
  mutate(super_region = ifelse(super_region %in% ser_with_no_sample$super_region, "not_defined", super_region))

#split of not defined regions
not_defined <- super_regions %>%  filter(super_region == "not_defined")
super_regions <- super_regions %>% filter(super_region != "not_defined")

#plot
plo <- super_regions
ord <- sample(plo$super_region, size = nrow(plo))

plo <- plo %>%
  mutate(super_region = factor(super_region, levels = ord))

# get centroids
cent <- plo %>%
  st_centroid()

# add numbers to region
cent <- cent %>%
  arrange(as.character(super_region)) %>%
  mutate(num = seq(1:nrow(.)))

lab <- cent %>%
  select(super_region, num)

st_geometry(lab) <- NULL

write_csv(lab,  file = "output/legend_01_super_ecoregions_numbers.csv")
save(lab,  file = "output/numbers_plot_superecoregions.rda")

#plot
plo_out <- ggplot()+
  geom_sf(data = not_defined, fill = "grey", color = "black", size = 0.1)+
  geom_sf(data = plo, aes(fill = super_region), color = "black", size = 0.1)+
  geom_sf_text(data = cent, aes(label = num), color = "black", size = 2.5, label.padding = unit(0.1, "lines"))+
  theme_bw()+
  theme(legend.position = "none",
        axis.title = element_blank())

ggsave(plo_out, file = "output/01_super_ecoregions_numbers.pdf",
       width = 18, height = 14,
       limitsize = FALSE)

#save as shape file
st_write(obj = super_regions,
         "output/super_ecoregions.shp",
         driver = "ESRI Shapefile", overwite = TRUE)
