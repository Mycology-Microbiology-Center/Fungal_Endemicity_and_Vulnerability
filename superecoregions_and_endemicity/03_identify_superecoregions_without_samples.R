library(sf)
library(tidyverse)
library(viridis)

#load data
load(file = "output/otu_table.rda")
load(file = "output/super_ecoregions.rda")

# calculate the number of samples per superregion
plo <- otu_table %>%
  select(sample_id, geo_superregion) %>%
  distinct() %>%
  group_by(geo_superregion) %>%
  count()

# check if any of the plot superregions are not found in the shape file
plo %>% filter(!geo_superregion %in% super_regions$super_region)
plo <- super_regions %>%
  left_join(plo, by = c("super_region" = "geo_superregion")) %>%
  mutate(samples_per_area = n / as.numeric(area) * 10000)

n_samples <- plo
save(n_samples,
     file = "output/number_of_samples_per_superecoregion.rda")

#deal with regions without samples
## list of super-regions without samples
# All these should be greyed out on the map
ser_with_no_sample <- plo %>% filter(is.na(n)) %>%select(super_region)
st_geometry(ser_with_no_sample) <-  NULL
save(ser_with_no_sample,
     file = "output/super_region_without_sample.rda")
