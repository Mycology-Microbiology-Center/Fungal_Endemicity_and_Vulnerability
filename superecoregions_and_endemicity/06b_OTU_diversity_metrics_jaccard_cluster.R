library(tidyverse)
library(readxl)
library(betapart)
library(sf)

#load data
load(file = "region_by_OTU_matrix.rda")

#run on cluster for RAM reasons
beta <- beta.pair(x = baselga, index.family = "jaccard")

#jaccard total
jac <- as.matrix(beta$beta.jac)
diag(jac) <- NA
jac <- data.frame(rowMeans(jac, na.rm = TRUE))
jac$geo_superregion <- rownames(jac)
names(jac) <- c("jac", "geo_superregion")

#jaccard turnover
jtu <- as.matrix(beta$beta.jtu)
diag(jtu) <- NA
jtu <- data.frame(rowMeans(jtu, na.rm = TRUE))
jtu$geo_superregion <- rownames(jtu)
names(jtu) <- c("jtu", "geo_superregion")

jaccard <- jac %>%
  left_join(jtu)

save(jaccard, file = "jaccard.rda")
