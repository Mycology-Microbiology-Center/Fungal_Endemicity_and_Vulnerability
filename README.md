# Global patterns in endemicity and vulnerability of soil fungi <img src='img/MMC_logo.png' align="right" height="100" />

This repository contains the code associated with the paper:

Leho Tedersoo, Vladimir Mikryukov, Alexander Zizka, Mohammad Bahram, Niloufar Hagh-Doust,
Sten Anslan, Oleh Prylutskyi, Manuel Delgado-Baquerizo, Fernando T. Maestre, Jaan Pärn, Maarja Öpik, 
Mari Moora, Martin Zobel, Mikk Espenberg, Ülo Mander, Abdul Nasir Khalid, Adriana Corrales, 
Ahto Agan, Aída-M. Vasco-Palacios, Alessandro Saitta, Andrea C. Rinaldi, Annemieke Verbeken, 
Bobby P. Sulistyo, Boris Tamgnoue, Brendan Furneaux, Camila Duarte Ritter, Casper Nyamukondiwa, 
Cathy Sharp, César Marín, Daniyal Gohar, Darta Klavina, Dipon Sharmah, Dong Qin Dai, 
Eduardo Nouhra, Elisabeth Machteld Biersma, Elisabeth Rähn, Erin K. Cameron, Eske De Crop, 
Eveli Otsing, Evgeny A. Davydov, Felipe E. Albornoz, Francis Q. Brearley, Franz Buegger,
Geoffrey Zahn, Gregory Bonito, Inga Hiiesalu, Isabel C. Barrio, Jacob Heilmann-Clausen, 
Jelena Ankuda, John Y. Kupagme, Jose G. Maciá-Vicente, Joseph Djeugap Fovo, József Geml, 
Juha M. Alatalo, Julieta Alvarez-Manjarrez, Kadri Põldmaa, Kadri Runnel, Kalev Adamson, 
Kari Anne Bråthen, Karin Pritsch, Kassim I. Tchan, Kęstutis Armolaitis, Kevin D. Hyde, 
Kevin K. Newsham, Kristel Panksep, Adebola A. Lateef, Liis Tiirmann, Linda Hansson, Louis J. Lamit, 
Malka Saba, Maria Tuomi, Marieka Gryzenhout, Marijn Bauters, Meike Piepenbring, Nalin Wijayawardene, 
Nourou S. Yorou, Olavi Kurina, Peter E. Mortimer, Peter Meidl, Petr Kohout, R. Henrik Nilsson, 
Rasmus Puusepp, Rein Drenkhan, Roberto Garibay-Orijel, Roberto Godoy, Saad Alkahtani, Saleh Rahimlou, 
Sergey V. Dudov, Sergei Põlme, Soumya Ghosh, Sunil Mundra, Talaat Ahmed, Tarquin Netherway, 
Terry W. Henkel, Tomas Roslin, Vincent Nteziryayo, Vladimir E. Fedosov, Vladimir G. Onipchenko, 
W. A. Erandi Yasanthika, Young Woon Lim, Nadejda A. Soudzilovskaia, Alexandre Antonelli, 
Urmas Kõljalg, Kessy Abarenkov (2022) 
*Global patterns in endemicity and vulnerability of soil fungi* //
**Global Change Biology**, [DOI:10.1111/gcb.16398](https://onlinelibrary.wiley.com/doi/abs/10.1111/gcb.16398)

## Dataset
<p align="middle">
  <img src="img/Dataset_Samples.png" width="800" title="Dataset"/>
</p>

The dataset is composed of the Global Soil Mycobiome consortium (**GSMc**) open dataset (Tedersoo et al., 2021) with materials from five other global soil biological surveys – **BIODESERT** (Maestre et al., 2022), **MUSGONET** (including the natural sites in Delgado-Baquerizo et al., 2021), **CLIMIFUN** (Bastida et al., 2021), **GlobalAM** (Davison et al., 2021), **GlobalWetlands** (Bahram et al., 2022), and Sanger sequence data from soil-inhabiting fungi obtained from the **UNITE** database (Nilsson et al., 2019) covering GenBank.

## Main scripts

### Vulnerability

| Script file                                   | Description                                                                                      |
| --------------------------------------------- | ------------------------------------------------------------------------------------------------ |
| `bin/Vulnerability_script.R`                  | Vulnerability indices estimation                                                                 |
| `bin/Vulnerability_script_map.R`              | Vulnerability model fitting (LM and GAM), spatial prediction                                     |
| `bin/Diversity_residuals.R`                   | Estimate diversity residuals on a grid                                                           |
| `bin/LUH_cumsum_script_parallel.R`            | Estimate the cumulative sum of land cover transitions                                            |
| `bin/RasterModel_MergeResids_on_HPC.R`        | Merging the residuals into a single raster and creation of co-kriging map                        |
| `bin/Vulnerability_script_averaging.R`        | Vulnerability averaging  (ordinary and correlation-weighted)                                     |
| `bin/Vulnerability_script_averaging_cokrig.R` | Estimation and plotting the average vulnerability                                                |
| `bin/Vulnerability_script_averaging_SE.R`     | Estimation of the standard errors for averaged vulnerability using Burnaham and Anderson formula |
| `bin/Vulnerability_script_PlotT2_cokrig.R`    | Plotting the `t2` vulnerability index                                                            |

Please find the usage instructions in the [`bin` directory](https://github.com/Mycology-Microbiology-Center/Fungal_Endemicity_and_Vulnerability/tree/main/bin).

### Superecoregions and endemicity

| Script file                                             | Description                                                  |
| ------------------------------------------------------- | ------------------------------------------------------------ |
| `01_generate_superecoregions.R`                         | Superecoregion preparation                                   |
| `02_remove_problematic samples_and_check_input.R`       | Removal of problematic samples                               |
| `03_identify_superecoregions_without_samples.R`         | Identification of unsampled ecoregions                       |
| `04_plot_superecoregions_and_samples_per_superregion.R` | Data visualization                                           |
| `05_get_maximum_distance_among_OTU_instances.R`         | Estimation of the maximum distance among OTU occurrences     |
| `06_OTU_diversity_metrics.R`                            | Diversity metrics (Richness, Jaccard and Beta-sim indices)   |
| `06b_OTU_diversity_metrics_jaccard_cluster.R`           | Jaccard turnover (on HPC)                                    |
| `07_prepare_superregion_meta.R`                         | Polygon validation and metadata preparation                  |
| `08_plot_superregion_stats.R`                           | Visualization of superecoregions                             |
| `09_crisp_and_prop_endemics_for_all_groups.R`           | Endemism estimation (Crisp index and proportion of endemics) |
| `10_map_endemicity_metrics.R `                          | Visualization of endemicity metrics                          |

The usage instruction is available in the [`superecoregions_and_endemicity` directory](https://github.com/Mycology-Microbiology-Center/Fungal_Endemicity_and_Vulnerability/tree/main/superecoregions_and_endemicity).

## Accessory scripts

| Script file               | Description                                                        |
| ------------------------- | ------------------------------------------------------------------ |
| `R/ASINH_Precipitation.R` | Precipitation transformation (negative of inverse hyperbolic sine) |

## Software dependencies
- [`R`](https://cran.r-project.org/) >= v.4.1.0 (R Core Team, 2022)
- [`raster`](https://rspatial.org/raster/) >= v.3.5 (Hijmans, 2022)
- [`sp`](https://github.com/edzer/sp/) >= v.1.2 (Pebesma, Bivand, 2005)
- [`sf`](https://r-spatial.github.io/sf/) >= v.1.0-8 (Pebesma, 2018)
- [`gstat`](https://r-spatial.github.io/gstat/) >= v.2.0 (Pebesma, 2004)
- [`mgcv`](https://github.com/cran/mgcv) >= v.1.8 (Wood, 2011)
- [`gratia`](https://github.com/gavinsimpson/gratia) >= v.0.7.3 (Simpson, 2022)
- [`vuln`](https://github.com/phytomosaic/vuln) >= v.0.0.05-2019-09-18 (Smith *et al*., 2019; [doi:10.1111/jbi.13719](https://onlinelibrary.wiley.com/doi/10.1111/jbi.13719))
- [`ecole`](https://github.com/phytomosaic/ecole) >= 0.8-2021 ()
- [`data.table`](https://github.com/Rdatatable/data.table) >= v.1.14.0 (Dowle, Srinivasan, 2021)
- [`plyr`](https://github.com/hadley/plyr) v.1.8.6 (Wickham, 2011)
- [`ncdf4`](https://cirrus.ucsd.edu/~pierce/ncdf/) >= v.1.19 (Pierce, 2021)
- [`betapart`](https://github.com/cran/betapart) (Baselga, Orme, 2012; [doi:10.1111/j.2041-210X.2012.00224.x](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/j.2041-210X.2012.00224.x))
- [`geosphere`](https://github.com/rspatial/geosphere) (Hijmans *et al*., 2021)
- [`tidyverse`](https://tidyverse.tidyverse.org/) (Wickham *et al*., 2019; doi:{10.21105/joss.01686)
- [`readxl`](https://readxl.tidyverse.org/) (Wickham and Bryan, 2022)
- [`rnaturalearth`](https://docs.ropensci.org/rnaturalearth/) (South, 2022)
- [`viridis`](https://sjmgarnier.github.io/viridis/) (Garnier *et al*., 2021; doi:10.5281/zenodo.4679424)

## Data availability

Gridded **maps** are available at Zenodo [DOI:10.5281/zenodo.6983158](https://doi.org/10.5281/zenodo.6983158).

The code of bioinformatic analyses is deposited in the [GSMc repository](https://github.com/Mycology-Microbiology-Center/GSMc).

## Citation
